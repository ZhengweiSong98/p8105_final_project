---
title: "Data Introduction and Further Processing"
output: 
  html_document: 
    toc: yes
    toc_float: yes
editor_options: 
  chunk_output_type: console
---

```{r include = F}
library(tidyverse)
library(tidytext)  
library(ggplot2)
library(httr)
library(rvest)
library(lubridate)
library(plotly)
library(patchwork)
library(lmtest)
```

```{r source, r, include = F}
source("data_preprocessing_backbone.R")
```

## Introduction 
COVID-19 has resulted in many long-term effects on societies all across the world, especially in areas with high population density such as the State of California. The motivation of our project is to investigate the trends of COVID-19 new cases development in the past in relation with factors like vaccine administration and demographic factors. We aim to eventually come up with conclusions that can identify vulnerable groups and areas to COVID-19 and offer suggestions for the protection of people against the disease. We are particularly interested in topics such as the relationship between county population size and COVID-19 prevalence, and the COVID-19 prevalence between different age groups. 

Begin the data processing procedure by loading all of the interested dataframes from the internet, including `Age.csv`, `Demo.csv`,`12-plus.csv`,`16-plus.csv`, and `Post_stat.csv`.

```{r warning = F, message = F}
age_df = read_csv("data/age.csv")
demo_df = read_csv("data/demo.csv")
stat_12 = read_csv("data/12_plus.csv")
stat_16 = read_csv("data/16_plus.csv")
post_stat = read_csv("data/post_stat.csv")
```

## Age, race and gender datasets

`Age.csv` originally has `r nrow(age_df)` rows and `r ncol(age_df)` variables. It includes COVID-19 data such as total case, percent case, deaths in respect to three different demographic groups including age group, race ethnicity, and gender. Thus, we decide to separate it into three distinct data frames, each describing on one demographic group. We also arranged the sequence of the columns by moving the 'date' variable in front of other variables to better match the sequence of other data frames in this study.


```{r warning = F, message = F}
## datasets of age_df
age =
    age_df %>%
    janitor::clean_names() %>%
    filter(demographic_category == "Age Group") %>%
    select(report_date,
            demographic_value,
            total_cases,
            deaths,
            percent_deaths,
            percent_of_ca_population) %>%
    drop_na() %>%
    rename("age_group" = demographic_value,
           "date" = report_date)

race =
    age_df %>%
    janitor::clean_names() %>%
    filter(demographic_category == "Race Ethnicity") %>%
    select(report_date,
           demographic_value,
           total_cases,
           deaths,
           percent_deaths,
           percent_of_ca_population) %>%
    drop_na() %>%
    rename("age_group" = demographic_value,
           "date" = report_date)

gender =
    age_df %>%
    janitor::clean_names() %>%
    filter(demographic_category == "Gender") %>%
    select(report_date,
           demographic_value,
           total_cases,
           deaths,
           percent_deaths,
           percent_of_ca_population) %>%
    drop_na() %>%
    rename("age_group" = demographic_value,
           "date" = report_date)
```

## Demographic dataset

`Demo.csv` originally has `r nrow(demo_df)` rows and `r ncol(demo_df)` variables.It contains COVID-19 data belonging to different demographic areas, mainly the different counties in the state of California, but it also includes COVID-19 data for the whole states. For our purposes, we decide to focus our analysis on comparing the COVID-19 data in different counties. Thus we decide to drop any rows with the `area_type` of state. Then, delete the column `area_type` and rename the column `area` to `county_name`. We also decide to focus our analysis on the cumulative COVID-19 data instead of the changes per day. Thus we delete some columns including `total_test`, `positive_test`, `reported_cases`, `reported_deaths`, and `reported_tests`. Lastly, drop all of the rows containing N/A values.The resulted data frame includes data such as the population, the cumulative cases, tests, and reported deaths of the county.


```{r warning = F, message = F}
## dataset of demo
demo_df = read_csv("data/demo.csv")

demo =
    demo_df %>%
    filter(area_type == "County") %>%
    select(-c(area_type, 
              total_tests, 
              positive_tests, 
              reported_cases, 
              reported_deaths, 
              reported_tests)) %>%
    rename("county_name" = area)
```

## Post statistics categorized by age

`12-plus.csv`, `16-plus.csv`, `Post_stat.csv` are legacy tables about COVID-19 status based on previous separation between standard vaccinated and boosted groups, with restriction on the age group above 16, above 12, and no restriction respectively. `12-plus.csv` originally has `r nrow(stat_12)` rows and `r ncol(stat_12)` variables. `16-plus.csv` originally has `r nrow(stat_16)` rows and `r ncol(stat_16)` variables. `Post_stat.csv` originally has `r nrow(post_stat)` rows and `r ncol(post_stat)` variables.Since the `AREA` and `AREA_TYP` columns contain the exact information throughout all of these data frames, it is not valuable for our purpose and thus we remove them. We also removed six data rows before the date 02/07/2021 due to missing data in the `12-plus.csv` and `Post_stat.csv`.

```{r warning = F, message = F}
## datasets of post_stat
stat_12 = stat_12[-(1:6),]
stat_12 =
    stat_12 %>%
    arrange(date, decreasing = F) %>%
    select(-c(area_type, area))



stat_16 = stat_16[-(1:6),]
stat_16 =
    stat_16 %>%
    janitor::clean_names() %>%
    arrange(date, decreasing = F) %>%
    select(-c(area_type, area))

post_stat = post_stat[-(1:6),]
post_stat =
    post_stat %>%
    janitor::clean_names() %>%
    arrange(date, decreasing = F) %>%
    select(-c(area_type, area))

```

